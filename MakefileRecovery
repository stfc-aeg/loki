all: os

# This makefile requires a LOKI Makefile project

LOKI_DIR=./
APPLICATION_DIR=./loki-recovery/
LOKI_ENV_DIR=./loki-recovery/

# Include recipes to take the environment and run the configuration using the autoconf params
# Provides loki-configure-hw, loki-configure-sw, loki-configure-os
include ${LOKI_DIR}/config.mk

block_design=${LOKI_DIR}/design/block_design/zusys_bd.tcl

.PHONY: all os hardware software project constraints

constraints_src_dir=${APPLICATION_DIR}/constraints/
constraints_filename=$(wildcard *.xdc)
constraints_dst_dir=${LOKI_DIR}/design/constraints/${platform_module_shortname}/

constraints: loki-configure-hw ${constraints_src_dir}/${constraints_filename}
	$(info Adding project constraints from ${constraints_src_dir}/${constraints_filename} to ${constraints_dst_dir}/${constraints_filename})
	$(info pwd $(shell pwd))
	$(shell cp ${constraints_src_dir}/${constraints_filename} ${constraints_dst_dir}/)

project: loki-configure-hw constraints
	# Instead of actually building the hardware, just make the project in Vivado and stop
	$(MAKE) -C ${LOKI_DIR} project

hardware:
	$(MAKE) -C ${LOKI_DIR} hardware

software: loki-configure-sw hardware
	$(MAKE) -C ${LOKI_DIR} software

os: loki-configure-os software
	$(MAKE) -C ${LOKI_DIR} os

mostlyclean:
	$(MAKE) -C ${LOKI_DIR} mostlyclean

clean:
	$(MAKE) -C ${LOKI_DIR} clean

distclean:
	$(MAKE) -C ${LOKI_DIR} distclean

clobber:
	$(MAKE) -C ${LOKI_DIR} clobber
